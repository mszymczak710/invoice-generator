<mat-card class="klg-section">
  <div class="section-heading-wrapper">
    <h2 class="section-heading">{{ strings.listHeader }}</h2>
  </div>

  <div class="table-container">
    <table class="mt-3" mat-table [dataSource]="data" matSort multiTemplateDataRows>
      <caption>{{ strings.listCaption }}</caption>

      @for (column of columns; track column) {
        <ng-container [matColumnDef]="column.name">
          <th
            mat-header-cell
            *matHeaderCellDef
            [class]="column.styles?.cssClass"
            [class.narrow]="column.styles?.isNarrow"
            [style.text-align]="column.styles?.alignment"
          >
            {{ column.label }}
          </th>
          <td mat-cell *matCellDef="let row" [class]="column.styles?.cssClass" [style.text-align]="column.styles?.alignment">
            <klg-table-cell-loader [column]="column" [row]="row"></klg-table-cell-loader>
          </td>
          <td mat-footer-cell *matFooterCellDef>
            @if (column.name === 'count') {
              <strong>{{ strings.summaryLabel }}</strong>
              <span class="ms-1">{{ getTotalAmount() | number: '1.2-2' }}</span>
            }
          </td>
        </ng-container>
      }

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>

      <tr mat-mdc-no-data-row *matNoDataRow>
        <td [attr.colspan]="displayedColumns.length" class="text-error text-center">
          @if (!loading) {
            {{ strings.noDataRow }}
          }
        </td>
      </tr>
    </table>

    <klg-spinner size="big" [visible]="loading"></klg-spinner>
  </div>
</mat-card>
